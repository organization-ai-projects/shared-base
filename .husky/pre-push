#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Arrêt en cas d'erreur
set -e

# Vérification de pnpm-lock.yaml
echo "🔒 Checking pnpm-lock.yaml..."
if ! pnpm install --frozen-lockfile --prefer-offline > /dev/null 2>&1; then
  echo "❌ Lockfile check failed. Please update pnpm-lock.yaml."
  exit 1
fi

# Lint complet
echo "🔍 Full linting..."
pnpm lint || exit 1

# Tests avec couverture
echo "🧪 Running tests with coverage..."
pnpm test:coverage || exit 1

# Assurer que tout est stageé avant de pousser
git diff --exit-code || exit 1
